name: "[CI] EV Battery TEST SERVICE"

on:
  push:
    branches:
      - develop
      - main

jobs:
  build:
    name: Build Project
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Java
        uses: actions/setup-java@v3
        with:
          distribution: "temurin"
          java-version: "21"
          cache: maven

      - name: Build project with Maven
        run: mvn clean package -DskipTests

      - name: Notify Discord - Build Successful
        if: success()
        run: |
          curl -s -X POST ${{ secrets.DISCORD_WEBHOOK_URL }} \
            -H "Content-Type: application/json" \
            -d '{
              "embeds": [{
                "title": "✅ Build Successful",
                "description": "EVC Flight Hub Test Service built successfully",
                "color": 3066993,
                "fields": [
                  {"name": "Branch", "value": "${{ github.ref_name }}", "inline": true},
                  {"name": "Commit", "value": "${{ github.sha }}", "inline": true}
                ]
              }]
            }' || true

      - name: Notify Discord - Build Failed
        if: failure()
        run: |
          curl -s -X POST ${{ secrets.DISCORD_WEBHOOK_URL }} \
            -H "Content-Type: application/json" \
            -d '{
              "embeds": [{
                "title": "❌ Build Failed",
                "description": "EVC Flight Hub Test Service build failed",
                "color": 15158332,
                "fields": [
                  {"name": "Branch", "value": "${{ github.ref_name }}", "inline": true},
                  {"name": "Commit", "value": "${{ github.sha }}", "inline": true}
                ]
              }]
            }' || true
